<!DOCTYPE html>
<html>
  <head>
<base target="_top">
<style>

body{font-family:sans-serif;font-size:.8em;}
#teacherfeedback,#previoustarget{background-color:lightgrey;padding:5px;}
#tcomment,#targetset{background-color:white;margin:5px;}
#studentcomment{background-color:lightsteelblue;padding:5px;}

</style>
  </head>
  <body>
<img src="http://warwickcomputing.studio/splat.jpg" width=100px>
  <b><div id="greeting"></div></b>
  <div id="teacherfeedback">
  <p>
  Teacher feedback on your work
  </p>
  <p>Comments
  <div id="tcomment"> <img width=50 src="https://thumbs.gfycat.com/ImpassionedAfraidDipper-size_restricted.gif"></div>
  </p>
   <p>Target
  
  <div id="targetset"><img width=50 src="https://thumbs.gfycat.com/ImpassionedAfraidDipper-size_restricted.gif"> </div>
  </p>
  </div>
  <br>
  
  <form id="myFormId" onsubmit="return false;">
  <div id="studentcomment">
  
  <p>Enter your feedback below as a response to the teachers comment.</p>
  
  <textarea id="studcomment" rows="4" cols="37"></textarea>
  
  <div id="rag">
  Assess how solid your understanding of the ideas covered in the homework is:<br/>
 <span style="background-color:red;padding:2px;"><input type="radio" name="rag" value="red"> RED</span>
  <span style="background-color:orange;padding:2px;"><input type="radio" name="rag" value="amber" checked> AMBER</span>
  <span style="background-color:lime;padding:2px;"><input type="radio" name="rag" value="green" > GREEN</span> 
  </div>

<br>
  
  <button type="submit" onclick="studentresponse()" id="Button" disabled>Submit Response</button>
</div>
</form>
  <div id=""><p>
  <div id="previoustarget">
  <p>
  Below is a list of outstanding targets.<br/>
  Check the box if you feel you have met the target in this homework.
  </p>
  <div id="currentTargets"><img width=50 src="https://thumbs.gfycat.com/ImpassionedAfraidDipper-size_restricted.gif"></div>
  </div>
  </body>
  
  <script>
    
    window.onload = function(){google.script.run.withSuccessHandler(output).getcomments();}
    
    function output(details){
 
    if (details != false){
    var greeting = "Hello " + details[0].split(" ", 1);
    
    document.getElementById("greeting").innerHTML = greeting;
    document.getElementById("tcomment").innerHTML = details[1];
    document.getElementById("targetset").innerHTML = details[2];
    
    var ct='';
    for (i = 0; i < details[4].length; i++) { 
    ct += '<span id="target'+details[4][i][0]+'"><input type="checkbox" name="ct" onclick="updateTarget(\''+details[4][i][0] +'\');"> '+details[4][i][1] + '</span><br>';
    }
    document.getElementById("currentTargets").innerHTML = ct;
    var btn = document.getElementById("Button"); 
  btn.disabled = false;
    }
    else{
    document.getElementById("studentcomment").innerHTML = "<h3>Awaiting to be marked</h3>";
    }
    
    
    }
    
    function updateTarget(x){
    //now need to mark spreadsheet as target met with this homework title (x is the row from the spreadsheet)
    google.script.run.withSuccessHandler(targetUpdated).updateTarget(x);
    
    
    }
    
    function targetUpdated(details){
    //remove from list
    document.getElementById("target"+details).innerHTML = "";
    }
    
    function studentresponse(){
    var inputs, index, form;

form = document.getElementById('myFormId'); // or form = document.formName
inputs = form.getElementsByTagName('input');
var formData = [];
formData.push(document.getElementById('studcomment').value);


for (index = 0; index < inputs.length; ++index) {
 if (inputs[index].checked){formData.push(inputs[index].value);}
}
  var btn = document.getElementById("Button"); 
  btn.disabled = true;
  google.script.run.withSuccessHandler(studentCommentUpdated).addStudentComment(formData);
    
    
    
    }
    
    
    function studentCommentUpdated(success){
    if (success){
    document.getElementById('studentcomment').innerHTML="<h3>Thanks for your reflection</h3>";
    }
    else{
      var btn = document.getElementById("Button"); 
  btn.disabled = false;

    }
  }
    
    
    </script>
    
    
</html>


