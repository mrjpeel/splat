<!DOCTYPE html>
<html>
  <head>
    <base target="_top">    
    <style>
       body{font-family:sans-serif;font-size:.8em;}
       #teacherfeedback,#previoustarget{background-color:lightgrey;padding:5px;}
       #tcomment,#targetset{background-color:white;margin:5px;}
       #hwkform{background-color:lightsteelblue;padding:5px;}
       #tracking{background-color:lightgrey;padding:5px;}
    </style>
  </head>
<body>
<img src="http://warwickcomputing.studio/splat.jpg" width=100px>
  <!-- DETAILS -->
  <div id='tracking' style="align: center">Locating Tracking Sheet <img width=20 src="http://warwickcomputing.studio/loading-circle.gif"></div>
  <br>
  <div>
    <form id="hwkform" onsubmit="return false;">
      Homework: <input id="number" name='number' type='text'  placeholder='e.g HWK 1' disabled/>
      <p>Please enter the grade for this work</p>
      <input id="grade" name='grade' type='text' size="7"/>  out of  <input id='markrange' name='markrange' type='text' size="7"/>
      <br>
  
      <!-- FEEDBACK -->
      <div>
        <p>Please enter review comments for student.</p>
        <textarea id="review" name='review' rows='4' cols='37' placeholder="What went well?"></textarea> 
        <p>Is there a specific target for the student</p>
        <textarea id="target" name='target' rows='4' cols='37' placeholder="Even better if"></textarea>
        <p>Is there a reference website to help them?</p>
        <textarea name='research' rows='4' cols='37' placeholder="Paste link here"></textarea>
      </div>
      <br>

      <!-- SUBMIT -->
      <div>
        <button id="Button" type='submit' onclick='writetosheet();' disabled>Submit Marking</button>
  
      </div>
    </form>
    <br>
  </div>
  
  
  
<script>
  
  //google.script.run.withSuccessHandler(sheetwritten).writetosheet()
  
  checktrackerfile();
  function checktrackerfile(){
    var findtracker = google.script.run.withSuccessHandler(onsuccess).findtracker();
  }
  
  function onsuccess(details){
  
  if(details[0]){
      document.getElementById('tracking').innerHTML = '<img width=20 src="http://warwickcomputing.studio/splat_tick.png"> ' +details[2] + ' found';
      document.getElementById('number').value = details[4];
      var btn = document.getElementById("Button"); 
      btn.disabled = false;

  } else {
  document.getElementById('tracking').style.color = '#ee2200';
      document.getElementById('tracking').innerHTML = 'Tracker not found, being created';
      window.setTimeout(2000);
      document.getElementById('tracking').innerHTML ='<img width=20 src="http://warwickcomputing.studio/splat_tick.png">' +details[2] + ' tracker file is in ' + details[1] + ' Classroom folder';
      window.setTimeout(2000);
      checktrackerfile();
  }
  
  }
  
  
  function writetosheet(){
  
    var inputs, index, form;
    form = document.getElementById('hwkform'); // or form = document.formName

    //do some validation
    var errorMsg = "";
    if (isNaN(parseInt(document.getElementById('grade').value))){
      errorMsg += "Mark needs to be an integer\n";
    }
    if (isNaN(parseInt(document.getElementById('markrange').value))){
      errorMsg += "Mark needs to be an integer\n";
    }
    if (errorMsg.length==0){
      if (parseInt(document.getElementById('grade').value)>=parseInt(document.getElementById('markrange').value))
        {errorMsg += "Mark can't be greater than 'out of'\n";   }
    }
    if (document.getElementById('review').value.length==0){
      errorMsg += "You need to write a comment\n";
    }
    if (document.getElementById('target').value.length==0){
      errorMsg += "You need to write a target";
    }


    if (errorMsg.length>0){
      alert(errorMsg);
      return false;
    }

    //form OK so we can now continue
    var formData = [];
    formData.push(document.getElementById('number').value);
    formData.push(document.getElementById('grade').value);
    formData.push(document.getElementById('markrange').value);
    formData.push(document.getElementById('review').value);
    formData.push(document.getElementById('target').value);

    var btn = document.getElementById("Button"); 
    btn.disabled = true;
  
    google.script.run.withSuccessHandler(sheetwritten).writetosheet(formData);
  }
  
  function sheetwritten(){
    document.getElementById('hwkform').innerHTML = '<h3>Tracker Sheet Updated</h3>';
  }
</script>
  
  </body>
</html>


